# Data Visualization Environment
# Specialized for data science and visualization

FROM ubuntu:22.04

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=UTC
ENV LANG=en_US.UTF-8
ENV LANGUAGE=en_US:en
ENV LC_ALL=en_US.UTF-8

# Install system dependencies
RUN apt-get update && apt-get install -y \
    # Basic tools
    curl \
    wget \
    git \
    vim \
    nano \
    htop \
    tree \
    unzip \
    zip \
    # Build tools
    build-essential \
    cmake \
    pkg-config \
    # Python dependencies
    python3 \
    python3-pip \
    python3-venv \
    python3-dev \
    python3-tk \
    # Data science dependencies
    libhdf5-dev \
    libhdf5-serial-dev \
    libhdf5-103 \
    libhdf5-cpp-103 \
    # Clean up
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Install Node.js for data tools
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
    && apt-get install -y nodejs

# Install Python packages for data science
RUN pip3 install --upgrade pip && \
    pip3 install \
    # Core data libraries
    numpy \
    pandas \
    scipy \
    scikit-learn \
    # Visualization
    matplotlib \
    seaborn \
    plotly \
    bokeh \
    altair \
    # Jupyter and notebooks
    jupyter \
    jupyterlab \
    ipykernel \
    ipywidgets \
    # Data processing
    requests \
    beautifulsoup4 \
    lxml \
    opencv-python \
    pillow \
    # Web frameworks
    streamlit \
    dash \
    flask \
    fastapi \
    uvicorn \
    # Development tools
    black \
    flake8 \
    pytest \
    # Data sources
    yfinance \
    pandas-datareader \
    ccxt

# Install Jupyter extensions
RUN jupyter labextension install @jupyterlab/toc

# Create development user
RUN useradd -m -s /bin/bash dev && \
    usermod -aG sudo dev && \
    echo 'dev ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers

# Create development directories
RUN mkdir -p /home/dev/workspace \
    /home/dev/.config/nvim \
    /home/dev/.local/share/nvim \
    /home/dev/.cache/nvim \
    /home/dev/.jupyter

# Copy Neovim configuration
COPY configs/nvim/ /home/dev/.config/nvim/
RUN chown -R dev:dev /home/dev/

# Set up Jupyter configuration
RUN echo 'c.ServerApp.ip = "0.0.0.0"' >> /home/dev/.jupyter/jupyter_lab_config.py && \
    echo 'c.ServerApp.port = 8000' >> /home/dev/.jupyter/jupyter_lab_config.py && \
    echo 'c.ServerApp.allow_root = True' >> /home/dev/.jupyter/jupyter_lab_config.py && \
    echo 'c.ServerApp.open_browser = False' >> /home/dev/.jupyter/jupyter_lab_config.py && \
    chown -R dev:dev /home/dev/.jupyter

# Create data development scripts
COPY scripts/docker/data/ /home/dev/scripts/
RUN chmod +x /home/dev/scripts/*.sh && \
    chown -R dev:dev /home/dev/scripts/

# Expose data development ports
EXPOSE 8000 5000

# Set working directory
WORKDIR /home/dev/workspace

# Switch to development user
USER dev

# Set default command
CMD ["/bin/bash"]
